# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
ALLEXEC=simp lc3as gt16text gt16as
default: $(ALLEXEC)

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_core= common.cpp asm/asmrule.cpp asm/asmformat.cpp model/bigmemory.cpp model/machine.cpp model/model.cpp model/symbol.c ui/simui.cpp ui/reporter.cpp ui/logreporter.cpp ui/textstream.cpp ui/commandui.cpp format/format.cpp format/lineformat.cpp format/numformat.cpp format/objformat.cpp format/codeemitter.cpp arch/arch.cpp arch/sizes.cpp
DEPS_core= common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_core= common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
FILES_core=$(SOURCES_core) $(HEADERS_core)
ALL_SOURCES+=$(FILES_core)

bin/core/DONE: $(SOURCES_core) $(DEPS_core)
	build/build.sh compile $@

bin/core: bin/core/DONE
	@touch bin/core

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_lc3= lc3/lc3.c lc3/archlc3.cpp lc3/formatlc3.cpp lc3/machinelc3.cpp
DEPS_lc3= lc3/archlc3.h lc3/archstrap.h lc3/formatlc3.h lc3/lc3.h lc3/lc3os.h lc3/machinelc3.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_lc3= lc3/archlc3.h lc3/archstrap.h lc3/formatlc3.h lc3/lc3.h lc3/lc3os.h lc3/machinelc3.h
FILES_lc3=$(SOURCES_lc3) $(HEADERS_lc3)
ALL_SOURCES+=$(FILES_lc3)

bin/lc3/DONE: $(SOURCES_lc3) $(DEPS_lc3)
	build/build.sh compile $@

bin/lc3: bin/lc3/DONE
	@touch bin/lc3

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_lc2200= lc2200/archlc2200.cpp lc2200/formatlc2200.cpp lc2200/machinelc2200.cpp lc2200/asmformatlc2200.cpp
DEPS_lc2200= lc2200/archlc2200.h lc2200/archstrap.h lc2200/asmformatlc2200.h lc2200/formatlc2200.h lc2200/machinelc2200.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_lc2200= lc2200/archlc2200.h lc2200/archstrap.h lc2200/asmformatlc2200.h lc2200/formatlc2200.h lc2200/machinelc2200.h
FILES_lc2200=$(SOURCES_lc2200) $(HEADERS_lc2200)
ALL_SOURCES+=$(FILES_lc2200)

bin/lc2200/DONE: $(SOURCES_lc2200) $(DEPS_lc2200)
	build/build.sh compile $@

bin/lc2200: bin/lc2200/DONE
	@touch bin/lc2200

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_gt16= gt16/archgt16.cpp gt16/formatgt16.cpp gt16/machinegt16.cpp gt16/asmformatgt16.cpp
DEPS_gt16= gt16/archgt16.h gt16/archstrap.h gt16/asmformatgt16.h gt16/formatgt16.h gt16/machinegt16.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_gt16= gt16/archgt16.h gt16/archstrap.h gt16/asmformatgt16.h gt16/formatgt16.h gt16/machinegt16.h
FILES_gt16=$(SOURCES_gt16) $(HEADERS_gt16)
ALL_SOURCES+=$(FILES_gt16)

bin/gt16/DONE: $(SOURCES_gt16) $(DEPS_gt16)
	build/build.sh compile $@

bin/gt16: bin/gt16/DONE
	@touch bin/gt16

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_mips= mips/archmips.cpp mips/formatmips.cpp mips/machinemips.cpp mips/asmformatmips.cpp
DEPS_mips= mips/archmips.h mips/archstrap.h mips/asmformatmips.h mips/formatmips.h mips/machinemips.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_mips= mips/archmips.h mips/archstrap.h mips/asmformatmips.h mips/formatmips.h mips/machinemips.h
FILES_mips=$(SOURCES_mips) $(HEADERS_mips)
ALL_SOURCES+=$(FILES_mips)

bin/mips/DONE: $(SOURCES_mips) $(DEPS_mips)
	build/build.sh compile $@

bin/mips: bin/mips/DONE
	@touch bin/mips

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_text= text/textui.cpp text/term.cpp text/terminalstream.cpp
DEPS_text= text/term.h text/terminalstream.h text/textui.h text/uistrap.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_text= text/term.h text/terminalstream.h text/textui.h text/uistrap.h
FILES_text=$(SOURCES_text) $(HEADERS_text)
ALL_SOURCES+=$(FILES_text)

bin/text/DONE: $(SOURCES_text) $(DEPS_text)
	build/build.sh compile $@

bin/text: bin/text/DONE
	@touch bin/text

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_qt= qt/simplview.cpp qt/console.cpp qt/runthread.cpp qt/simpl.cpp qt/qtui.cpp
DEPS_qt= qt/simplview.h qt/qtui.h qt/console.h qt/simpl.h qt/runthread.h qt/uistrap.h qt/compat.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_qt= qt/simplview.h qt/qtui.h qt/console.h qt/simpl.h qt/runthread.h qt/uistrap.h qt/compat.h
FILES_qt=$(SOURCES_qt) $(HEADERS_qt)
ALL_SOURCES+=$(FILES_qt)

bin/qt/DONE: $(SOURCES_qt) $(DEPS_qt)
	build/build.sh compile $@

bin/qt: bin/qt/DONE
	@touch bin/qt

# WARNING: THIS IS AUTO-GENERATED -- MODIFY config/Makefile.in INSTEAD
SOURCES_bf= bf/allbf.cpp
DEPS_bf= bf/allbf.h bf/archstrap.h  common.h arch/arch.h arch/locid.h arch/option.h arch/sizes.h asm/asmformat.h asm/asmrule.h format/codeemitter.h format/fileformat.h format/format.h format/lineformat.h format/numformat.h format/objformat.h model/machine.h model/model.h model/symbol.h model/bigmemory.h ui/logreporter.h ui/reporter.h ui/simui.h ui/simview.h ui/commandui.h ui/textstream.h ui/inputbuffer.h
HEADERS_bf= bf/allbf.h bf/archstrap.h
FILES_bf=$(SOURCES_bf) $(HEADERS_bf)
ALL_SOURCES+=$(FILES_bf)

bin/bf/DONE: $(SOURCES_bf) $(DEPS_bf)
	build/build.sh compile $@

bin/bf: bin/bf/DONE
	@touch bin/bf

MAIN_SOURCES=main.cpp asm/asmmain.cpp
ALL_SOURCES+=$(MAIN_SOURCES)
GUIFILES=simpl.desktop hi16-app-simpl.png
TARDIR=simpl-src
TARBALL=simp.tar.gz
TARBALLGT16=simpgt16.tar.gz
TARDIRGT16=simpl-src-gt16
DOCZIP=simpl-doc.zip

default: $(ALLEXEC)

DOCFILES=README.CS2110 README LICENSE COPYING
BUILD=build/build.sh

BUILDFILES=build/Makefile.in build/*.sh build/targets build/packages build/core build/lc3 build/lc2200 build/qt build/text build/gt16 build/mips build/bf config.sh Doxyfile
DISTFILES=README.COMPILING $(BUILDFILES) $(DOCFILES) $(GUIFILES) $(ALL_SOURCES)
DISTFILESGT16=$(FILES_gt16) $(FILES_core) $(FILES_qt) $(FILES_text) $(MAIN_SOURCES) $(BUILDFILES) README.COMPILING $(DOCFILES) README.CS2200

#-- LC-3 binaries

lc3as: bin/core bin/lc3 asm/asmmain.cpp
	$(BUILD) link $@ "$+"

simp: bin/core bin/lc3 bin/lc2200 bin/text main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-3\"

simpl: bin/qt bin/core bin/lc3 bin/lc2200 main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-3\"

Simpl.app: simpl simp lc3as $(DOCFILES)
	$(BUILD) qtmacapp $@ $< "$+"

simpl-mac.tgz: Simpl.app
	tar -czf $@ $+

simpl-win.zip: simpl.exe lc3as.exe $(DOCFILES)
	$(BUILD) qtwinapp Simpl-Win $@ "$+"

#-- LC2200 Architecture

gt8as: bin/core bin/lc2200 asm/asmmain.cpp
	$(BUILD) link $@ "$+"

gt8text: bin/core bin/lc2200 bin/text main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-2200\"

gt8qt: bin/qt bin/core bin/lc2200 main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-2200\"

GT8Run.app: gt8qt gt8text gt8as $(DOCFILES)
	$(BUILD) qtmacapp $@ $< "$+"

gt8run-mac.tgz: GT8Run.app
	tar -czf $@ $+

gt8run-win.zip: gt8qt.exe gt8as.exe $(DOCFILES)
	$(BUILD) qtwinapp GT8Run-Win $@ "$+"

#-- LC2200-16 Architecture

gt16as: bin/core bin/gt16 asm/asmmain.cpp
	$(BUILD) link $@ "$+"

gt16text: bin/core bin/gt16 bin/text main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-2200\"

gt16qt: bin/qt bin/core bin/gt16 main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"LC-2200\"

GT16Run.app: gt16qt gt16text gt16as $(DOCFILES)
	$(BUILD) qtmacapp $@ $< "$+"

gt16run-mac.tgz: GT16Run.app
	tar -czf $@ $+

gt16run-win.zip: gt16qt.exe gt16as.exe $(DOCFILES)
	$(BUILD) qtwinapp GT16Run-Win $@ "$+"

#-- BF Architecture

bfas: bin/core bin/bf asm/asmmain.cpp
	$(BUILD) link $@ "$+"

bftext: bin/core bin/bf bin/text main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"BF\"

bfqt: bin/qt bin/core bin/bf main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"BF\"

BFRun.app: bfqt bftext bfas $(DOCFILES)
	$(BUILD) qtmacapp $@ $< "$+"

bfrun-mac.tgz: BFRun.app
	tar -czf $@ $+

bfrun-win.zip: bfqt.exe bfas.exe $(DOCFILES)
	$(BUILD) qtwinapp BFRun-Win $@ "$+"

#-- Mips Architecture

# Removed until assembler can handle data/text segments
#mipsas: bin/core bin/mips asm/asmmain.cpp
#	$(BUILD) link $@ "$+"

mipstext: bin/core bin/mips bin/text main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"Mips\"

mipsqt: bin/qt bin/core bin/mips main.cpp
	$(BUILD) link $@ "$+" -DARCHNAME=\"Mips\"

MipsRun.app: mipsqt mipstext mipsas $(DOCFILES)
	$(BUILD) qtmacapp $@ $< "$+"

mipsrun-mac.tgz: BFRun.app
	tar -czf $@ $+

mipsrun-win.zip: mipsqt.exe mipsas.exe $(DOCFILES)
	$(BUILD) qtwinapp MipsRun-Win $@ "$+"

#------------------------------------------------------------------------
#--- Distribution/Documentation

$(TARDIR): $(DISTFILES)
	[ ! -e $@ ] || rm -rf $@
	mkdir $@
	cp --parents $+ $@

$(TARBALL): $(TARDIR)
	tar -czf $@ $+


$(TARDIRGT16): $(DISTFILESGT16)
	[ ! -e $@ ] || rm -rf $@
	mkdir $@
	cp --parents $+ $@
	rm -f $@/build/targets
	echo 'TARGTEXT="gt16text gt16as"' >>$@/build/targets
	echo 'TARGQT="gt16qt"' >>$@/build/targets

$(TARBALLGT16): $(TARDIRGT16)
	tar -czf $@ $+


doc/html: $(ALL_SOURCES) Doxyfile
	rm -rf doc/html
	doxygen

doc/devdoc.pdf: doc/devdoc.tex
	$(BUILD) texpdf $@

docs: doc/html doc/devdoc.pdf

$(DOCZIP): docs
	rm -f $@
	zip -9 $@ doc/html/* doc/*.html doc/*.pdf doc/*.tex

doczip: $(DOCZIP)

tarball: $(TARBALL)

tarballgt16: $(TARBALLGT16)

dist: $(TARDIR)

clean:
	rm -rf bin $(ALLEXEC) $(TARDIR) $(TARBALL) $(TARDIRGT16) $(TARBALLGT16)

list:
	@echo $(ALL_SOURCES)

install: $(ALLEXEC) $(GUIFILES) $(DOCFILES)
	$(BUILD) install "$+" "$(ALLEXEC)"

count:
	wc -l $(BUILDFILES) | sort -n
	wc -l $(ALL_SOURCES) | sort -n
